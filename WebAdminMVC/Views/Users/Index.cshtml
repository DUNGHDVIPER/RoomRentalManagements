@model List<WebAdmin.MVC.Models.Users.UserListItemVm>
@{
    Layout = "_Layout";
    ViewData["Title"] = "Users";
}

<div class="container">
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success">
            @TempData["SuccessMessage"]
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger">
            @TempData["ErrorMessage"]
        </div>
    }

    <div class="card">
        <div class="card-head">
            <div class="card-title">User Management</div>
            <a class="btn-gradient" href="/Users/Create">+ Add New User</a>
        </div>

        <div class="table-wrap">
            <table class="table" data-table>
                <thead>
                    <tr>
                        <th>USER EMAIL</th>
                        <th>ROLE</th>
                        <th>STATUS</th>
                        <th class="th-right">ACTIONS</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var u in Model)
                    {
                        var initial = u.Email.Substring(0, 1).ToUpper();
                        <tr>
                            <td>
                                <div class="user-cell">
                                    <div class="avatar-box">@initial</div>
                                    <div class="user-email">@u.Email</div>
                                </div>
                            </td>
                            <td>
                                <span class="chip info">@u.Role</span>
                            </td>
                            <td>
                                @if (u.Status == "Active")
                                {
                                    <span class="chip success">Active</span>
                                }
                                else
                                {
                                    <span class="chip danger">Locked</span>
                                }
                            </td>
                            <td class="td-right">
                                <a class="link" href="/Users/Edit/@u.Id">Edit</a>

                                @if (u.Status == "Active")
                                {
                                    <form method="post" action="/Users/Lock/@u.Id" class="inline">
                                        @Html.AntiForgeryToken()
                                        <button class="link danger" type="submit"
                                                onclick="return confirm('Are you sure you want to lock this user?')">
                                            Lock
                                        </button>
                                    </form>
                                }
                                else
                                {
                                    <form method="post" action="/Users/Unlock/@u.Id" class="inline">
                                        @Html.AntiForgeryToken()
                                        <button class="link" type="submit">Unlock</button>
                                    </form>
                                }

                                <form method="post" action="/Users/Delete/@u.Id" class="inline">
                                    @Html.AntiForgeryToken()
                                    <button class="link danger" type="submit"
                                            onclick="return confirm('Are you sure you want to delete this user? This action cannot be undone.')">
                                        Delete
                                    </button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>