@model WebAdmin.MVC.Models.Contracts.ContractsIndexVm

@{
    ViewData["Title"] = "Contracts";
    Layout = "_Layout";
}

<h2 class="mb-3">Contracts</h2>

@if (TempData["Error"] is string err && !string.IsNullOrWhiteSpace(err))
{
    <div class="alert alert-danger">@err</div>
}
@if (TempData["Success"] is string ok && !string.IsNullOrWhiteSpace(ok))
{
    <div class="alert alert-success">@ok</div>
}

<form method="get" asp-action="Index" class="row g-2 mb-3">
    <div class="col-md-5">
        <input class="form-control" name="q" value="@Model.Query" placeholder="Search (code / roomId / tenantId)..." />
    </div>
    <div class="col-md-3">
        <select class="form-select" name="status">
            <option value="">-- All statuses --</option>
            <option value="1" selected="@(Model.Status == 1)">Active</option>
            <option value="0" selected="@(Model.Status == 0)">Pending</option>
            <option value="2" selected="@(Model.Status == 2)">Expired</option>
            <option value="3" selected="@(Model.Status == 3)">Terminated</option>
            <option value="4" selected="@(Model.Status == 4)">Renewed</option>
        </select>
    </div>
    <div class="col-md-2">
        <select class="form-select" name="pageSize">
            @{
                int[] sizes = new[] { 10, 20, 50 };
                foreach (var s in sizes)
                {
                    <option value="@s" selected="@(Model.PageSize == s)">@s / page</option>
                }
            }
        </select>
    </div>
    <div class="col-md-2 d-flex gap-2">
        <button class="btn btn-primary w-100" type="submit">Filter</button>
        <a class="btn btn-outline-secondary w-100" asp-action="Index">Reset</a>
    </div>
</form>

<div class="d-flex justify-content-between align-items-center mb-2">
    <div class="text-muted">
        Page <strong>@Model.Page</strong> / <strong>@(Model.TotalPages)</strong> —
        Total <strong>@Model.Total</strong> items
    </div>
    <a class="btn btn-success" asp-action="Create">+ Create</a>
</div>

<div class="table-responsive">
    <table class="table table-striped align-middle">
        <thead>
            <tr>
                <th style="width: 90px;">ContractId</th>
                <th style="width: 90px;">RoomId</th>
                <th style="width: 90px;">TenantId</th>
                <th>Start</th>
                <th>End</th>
                <th class="text-end">Rent</th>
                <th class="text-end">Deposit</th>
                <th>Status</th>
                <th style="width: 120px;"></th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Items == null || Model.Items.Count == 0)
            {
                <tr>
                    <td colspan="9" class="text-center text-muted py-4">No contracts found.</td>
                </tr>
            }
            else
            {
                foreach (var c in Model.Items)
                {
                    <tr>
                        <td>@c.ContractId</td>
                        <td>@c.RoomId</td>
                        <td>@c.TenantId</td>
                        <td>@c.StartDate.ToString("yyyy-MM-dd")</td>
                        <td>@c.EndDate.ToString("yyyy-MM-dd")</td>
                        <td class="text-end">@c.Rent.ToString("N0")</td>
                        <td class="text-end">@c.Deposit.ToString("N0")</td>
                        <td>
                            @if (c.IsActive || c.Status == 1)
                            {
                                <span class="badge bg-success">Active</span>
                            }
                            else if (c.Status == 0)
                            {
                                <span class="badge bg-warning text-dark">Pending</span>
                            }
                            else if (c.Status == 2)
                            {
                                <span class="badge bg-secondary">Expired</span>
                            }
                            else if (c.Status == 3)
                            {
                                <span class="badge bg-danger">Terminated</span>
                            }
                            else if (c.Status == 4)
                            {
                                <span class="badge bg-info text-dark">Renewed</span>
                            }
                            else
                            {
                                <span class="badge bg-light text-dark">Unknown</span>
                            }
                        </td>
                        <td class="text-end">
                            <a class="btn btn-sm btn-outline-primary"
                               asp-action="Details"
                               asp-route-id="@c.ContractId">
                                Details
                            </a>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>

@if (Model.TotalPages > 1)
{
    <nav aria-label="Contracts paging" class="mt-3">
        <ul class="pagination">
            @{
                bool prevDisabled = Model.Page <= 1;
                bool nextDisabled = Model.Page >= Model.TotalPages;

                int prevPage = Model.Page - 1;
                int nextPage = Model.Page + 1;

                int window = 2;
                int start = Math.Max(1, Model.Page - window);
                int end = Math.Min(Model.TotalPages, Model.Page + window);
            }

            <li class="page-item @(prevDisabled ? "disabled" : "")">
                <a class="page-link"
                   asp-action="Index"
                   asp-route-q="@Model.Query"
                   asp-route-status="@Model.Status"
                   asp-route-pageSize="@Model.PageSize"
                   asp-route-page="@prevPage">Previous</a>
            </li>

            @for (int p = start; p <= end; p++)
            {
                <li class="page-item @(p == Model.Page ? "active" : "")">
                    <a class="page-link"
                       asp-action="Index"
                       asp-route-q="@Model.Query"
                       asp-route-status="@Model.Status"
                       asp-route-pageSize="@Model.PageSize"
                       asp-route-page="@p">@p</a>
                </li>
            }

            <li class="page-item @(nextDisabled ? "disabled" : "")">
                <a class="page-link"
                   asp-action="Index"
                   asp-route-q="@Model.Query"
                   asp-route-status="@Model.Status"
                   asp-route-pageSize="@Model.PageSize"
                   asp-route-page="@nextPage">Next</a>
            </li>
        </ul>
    </nav>
}